import{A as e}from"./api_dbManage.4e8ccada.js";import{e as t}from"./verificationRules.28629627.js";import{n as i}from"./index.c66ec47f.js";import"./index.dfdb83b1.js";import"./vendor.194c4086.js";import"./bus.d56574c1.js";const n={};var a=i({name:"baseInfo",data(){return{row:{},SettingListErrMsg:"",loading:!1,titleShow:!1,titleText:"",createDBconfigForm:{shared_buffers:64},createDBconfigFormList:[],createDBconfigFormDict:{},byteUnitDict:{B:"",kB:"kB",MB:"MB",GB:"GB",TB:"TB"},timeUnitDict:{ms:"ms",s:"s",min:"min",h:"h",d:"d"},createDBconfigFormRules:{},memMax:2048,need_sync:this.needSync}},mounted(){const e=this;if(e.row&&(e.row=e.dbData),""!=e.row.setting_list_err_msg&&(e.SettingListErrMsg=this.$t("bestConfigInfo.congshujuku-peizhi-message")+this.row.setting_list_err_msg),null!=this.row.setting_list&&this.row.setting_list.length>0){let t=e.row;t.setting_list=e.sortData(t.setting_list),e.baseInfoList(t)}},props:{dbData:{required:!0},dbInfo:{required:!0},needSync:{required:!0}},watch:{needSync:function(e){this.need_sync=e}},methods:{calcUnitValue(e){if(null==e)return 1;if(""===e)return 1;if("B"===e)return 1;if("kB"===e)return 1024;if("MB"===e)return 1048576;if("GB"===e)return 1073741824;if("TB"===e)return 1099511627776;if("ms"===e)return 1;if("s"===e)return 1e3;if("min"===e)return 6e4;if("h"===e)return 36e5;if("d"===e)return 864e5;throw new Error(this.$t("createDatabasePage.wuxiao-danwei")+e)},validateRange(e,i,n){var a=this.createDBconfigFormDict[e.field];if("listen_addresses"!=e.field){if(null==i||""==i)return"archive_command"==e.field?void n():void n(new Error(this.$t("createDatabasePage.bixu-shuru-yigezhi")));if(null!=a.min_val||null!=a.max_val){var o=this.createDBconfigForm[e.field].unit,s=1;null!=o?s=this.calcUnitValue(o):o="";var r,l=0;if(3==a.setting_type||4==a.setting_type?(l=parseFloat(i.val),r=i.val,console.log("value="+i.val+",unit="+o+", unitValue="+s)):(l=parseFloat(i),r=i,console.log("value="+i+",unit="+o+", unitValue="+s)),isNaN(l))n(new Error(this.$t("createDatabasePage.qingshuru-shuzi")));else{var c=0,g=0,m=!0;"-∞"!=(c=null==a.min_val?"-∞":parseFloat(a.min_val))&&l*s<c&&(m=!1),"∞"!=(g=null==a.max_val?"∞":parseFloat(a.max_val))&&l*s>g&&(m=!1),console.log("minValue="+c+", maxValue="+g),m||n(new Error(this.$t("createDatabasePage.shuru-dezhi")+r+o+this.$t("createDatabasePage.chaoguo-fanwei")+c+", "+g+"]")),n()}}else n()}else t(e,i,n)},SelectChange(e){this.$refs.createDBconfigForm.validateField(e)},Move(e,t,i){let n=[].concat(e);return n.splice(i,0,n.splice(t,1)[0]),n},baseInfoList(e){const t=this;t.createDBconfigFormList=e.setting_list;let i=t.createDBconfigFormList.findIndex((e=>"cpu"===e.setting_name));-1!==i&&(t.createDBconfigFormList=t.Move(t.createDBconfigFormList,i,t.createDBconfigFormList.length-1)),t.createDBconfigForm={};for(let n=0;n<e.setting_list.length;n++)if(t.createDBconfigFormDict[e.setting_list[n].setting_name]=e.setting_list[n],t.createDBconfigFormRules[e.setting_list[n].setting_name]=[{required:!0,validator:this.validateRange,trigger:"blur"}],3===e.setting_list[n].setting_type||4===e.setting_list[n].setting_type){let i="";i=e.setting_list[n].unit,"track_activity_query_size"==e.setting_list[n].setting_name&&""==e.setting_list[n].unit&&(i="B"),t.$set(t.createDBconfigForm,e.setting_list[n].setting_name,{val:Number(e.setting_list[n].val),unit:i})}else t.$set(t.createDBconfigForm,e.setting_list[n].setting_name,e.setting_list[n].val);t.memMax=e.mem_size,t.createDBconfigForm.shared_buffers&&t.createDBconfigForm.shared_buffers.val>t.memMax&&(t.memMax=t.createDBconfigForm.shared_buffers.val),t.memMax<64&&t.createDBconfigForm.shared_buffers.val<t.memMax&&(t.memMax=64)},saveModifySubmit(){const t=this;this.$refs.createDBconfigForm.validate((i=>{if(i){let i=Object.assign({},t.createDBconfigForm),n=[];for(let e in i)i[e].unit?n.push({setting_name:e,val:i[e].val,unit:i[e].unit}):n.push({setting_name:e,val:i[e]});t.loading=!0;let a=Object.assign({},{db_id:t.dbInfo.db_id},{setting_list:n});t.need_sync?a.need_sync=1:a.need_sync=0,e.changeModifyDbConf(a).then((function(e){t.loading=!1,t.$message({type:"success",message:t.$t("baseInfo.xiugai-chenggong")}),null==e.is_restart?(t.titleShow=!0,t.titleText=e.msg):(t.titleShow=!1,e.is_restart,t.titleText=e.msg),t.getDBList()}),(function(e){t.titleShow=!1,t.loading=!1}))}}))},updateConfig:function(){const t=this;t.loading=!0;let i={db_id:t.dbInfo.db_id};e.getDbSettings(i).then((function(e){t.loading=!1;let i=e,n=[],a=i.setting_list;for(let o=0;o<a.length;o++)a[o].common_level==t.row.commontype&&n.push(a[o]);i.setting_list=t.sortData(n),i.commontype=t.row.commontype,t.row=i,t.titleShow=!1,t.baseInfoList(i),t.$message({type:"success",message:t.$t("bestConfigInfo.gengxin-chenggong")})}),(function(e){t.loading=!1}))},sortData:e=>(e.sort((function(e,t){return e.order_id<t.order_id?-1:e.order_id>t.order_id?1:0})),e),getDBList(){const t=this;let i={db_id:t.dbInfo.db_id};e.getDbSettings(i).then((function(e){t.loading=!1;let i=e,n=[],a=i.setting_list;for(let o=0;o<a.length;o++)a[o].common_level==t.row.commontype&&n.push(a[o]);i.commontype=t.row.commontype,t.row=i,i.setting_list=t.sortData(n),t.baseInfoList(i)}),(function(e){t.loading=!1}))}}},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-col",{attrs:{span:24}},[i("div",{staticStyle:{overflow:"hidden"}},[""!=e.SettingListErrMsg?i("span",{staticStyle:{display:"block","font-size":"14px","text-align":"center","margin-top":"20px"}},[i("el-alert",{attrs:{title:e.SettingListErrMsg,type:"error",closable:!1}})],1):e._e()]),i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"createDBconfigForm",staticStyle:{"margin-top":"10px","min-width":"1440px"},attrs:{model:e.createDBconfigForm,rules:e.createDBconfigFormRules,"label-width":"254px","element-loading-text":e.$t("Public.ping-ming-jia-zai-zhong")}},[i("el-row",[e._l(e.createDBconfigFormList,(function(t,n){return i("el-col",{key:n,staticStyle:{"margin-right":"10px"},attrs:{span:8}},[1==t.setting_type?i("el-form-item",{attrs:{label:t.setting_name,prop:t.setting_name}},["cpu"==t.setting_name?i("div",[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:e.$t("editConfigTab.CPU-shidocker-message"),placement:"top-end"}},[i("el-slider",{attrs:{"show-input":"",min:1,max:32,readonly:e.row.cluster_id&&!0},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],callback:function(t){e.$set(e.createDBconfigForm,e.createDBconfigFormList[n].setting_name,t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name]"}})],1)],1):i("div",[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:t.notes,placement:"top-end"}},[i("el-input",{attrs:{placeholder:e.$t("createDatabasePage.qingshuru-neirong")},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],callback:function(t){e.$set(e.createDBconfigForm,e.createDBconfigFormList[n].setting_name,t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name]"}})],1)],1)]):e._e(),2==t.setting_type?i("el-form-item",{attrs:{label:t.setting_name,prop:t.setting_name}},[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:t.notes,placement:"top-end"}},[i("el-select",{staticStyle:{width:"100%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze")},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],callback:function(t){e.$set(e.createDBconfigForm,e.createDBconfigFormList[n].setting_name,t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name]"}},[i("el-option",{attrs:{label:"off",value:"off"}}),i("el-option",{attrs:{label:"on",value:"on"}})],1)],1)],1):e._e(),3==t.setting_type?i("el-form-item",{attrs:{label:t.setting_name,prop:t.setting_name}},[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:t.notes,placement:"top-end"}},[i("el-input",{staticStyle:{width:"70%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qingshuru-neirong")},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name].val,callback:function(t){e.$set(e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],"val",t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name].val"}})],1),i("el-select",{staticStyle:{width:"30%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze")},on:{change:function(i){return e.SelectChange(t.setting_name)}},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name].unit,callback:function(t){e.$set(e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],"unit",t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name].unit"}},e._l(e.byteUnitDict,(function(e,t){return i("el-option",{key:e,attrs:{label:e,value:t}})})),1)],1):e._e(),4==t.setting_type?i("el-form-item",{attrs:{label:t.setting_name,prop:t.setting_name}},[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:t.notes,placement:"top-end"}},[i("el-input",{staticStyle:{width:"70%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qingshuru-neirong")},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name].val,callback:function(t){e.$set(e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],"val",t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name].val"}})],1),i("el-select",{staticStyle:{width:"30%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze")},on:{change:function(i){return e.SelectChange(t.setting_name)}},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name].unit,callback:function(t){e.$set(e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],"unit",t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name].unit"}},e._l(e.timeUnitDict,(function(e,t){return i("el-option",{key:e,attrs:{label:e,value:t}})})),1)],1):e._e(),5==t.setting_type?i("el-form-item",{attrs:{label:t.setting_name,prop:t.setting_name}},[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:t.notes,placement:"top-end"}},[i("el-select",{staticStyle:{width:"100%",float:"left"},attrs:{placeholder:e.$t("createDatabasePage.qing-xuan-ze")},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],callback:function(t){e.$set(e.createDBconfigForm,e.createDBconfigFormList[n].setting_name,t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name]"}},e._l(t.enumvals,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1)],1):e._e(),6==t.setting_type?i("el-form-item",{attrs:{label:t.setting_name,prop:t.setting_name}},[i("el-tooltip",{staticClass:"item",attrs:{"open-delay":1e3,disabled:!t.notes,effect:"dark",content:t.notes,placement:"top-end"}},[i("el-input",{attrs:{placeholder:e.$t("createDatabasePage.qingshuru-neirong")},model:{value:e.createDBconfigForm[e.createDBconfigFormList[n].setting_name],callback:function(t){e.$set(e.createDBconfigForm,e.createDBconfigFormList[n].setting_name,t)},expression:"createDBconfigForm[createDBconfigFormList[index].setting_name]"}})],1)],1):e._e()],1)})),"docker"===e.row.instance_type?i("el-col",{staticStyle:{"padding-left":"40px",color:"rgb(150 152 154)"},attrs:{span:24}},[e._v(e._s(e.$t("editConfigTab.xiugai-CPU-shared_buffers-message")))]):e._e()],2),i("el-form-item",[0!=e.createDBconfigFormList.length?i("el-button",{staticClass:"main",attrs:{loading:e.loading},on:{click:e.saveModifySubmit}},[e._v(e._s(e.$t("editConfigTab.baocun-xiugai")))]):e._e(),0!=e.createDBconfigFormList.length?i("el-button",{staticClass:"main",attrs:{loading:e.loading},on:{click:e.updateConfig}},[e._v(e._s(e.$t("bestConfigInfo.huoqu-peizhi")))]):e._e(),i("p",{staticStyle:{display:"inline-block",color:"red","margin-left":"10px"}},[e._v(e._s(e.titleText))])],1)],1)],1)}),[],!1,o,"1f8c3a58",null,null);function o(e){for(let t in n)this[t]=n[t]}var s=function(){return a.exports}();export{s as default};
