import{P as t}from"./index.dfdb83b1.js";import{n as e}from"./index.e6909a03.js";import"./vendor.194c4086.js";import"./bus.d56574c1.js";var l=e=>t("/api/v1/get_general_task_log",e),i=e=>t("/api/v1/do_terminate_basebackup",e);const o={};var a=e({name:"taskLog",data:()=>({loading:!1,content:"",closing:!1,intervalID:"",showTaskDetailVisible:!1,taskId:"",curHeight:"",lastSeq:0,closeCallBack:null,reading:!1}),methods:{stopTask:function(){const t=this;this.$confirm(t.$t("taskLog.queren-tingzhi")+t.taskId+t.$t("taskLog.de-rizhi-ma"),t.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{t.loading=!0;let e={task_id:t.taskId};i(e).then((function(e){t.loading=!1,clearInterval(t.smallIntervalID)}),(function(e){t.loading=!1}))})).catch((()=>{}))},openDialog:function(t,e,l){this.content="",this.taskHtml="",this.showTaskDetailVisible=!0,this.taskId=t,this.curHeight=document.documentElement.clientHeight-250,this.lastSeq=0;let i=this;i.closeCallBack=e,i.timeoutId&&console.log("**** timer "+i.timeoutId+" not destroy!!!"),i.timeoutId=setInterval((()=>{i.retriveTaskLog(l)}),500),console.log("create timeoutid="+i.timeoutId)},retriveTaskLog:function(t){let e=this,i={task_id:e.taskId,get_task_state:1,seq:e.lastSeq};e.reading=!0,l(i).then((function(t){let l=t;e.LogDatashow(l,0)}),(function(t){e.loading=!1,e.reading=!1,clearInterval(e.timeoutId)}))},LogDatashow:function(t,e){const l=this;let i="",o=t.data;console.log(t);for(let s=0;s<o.length;s++){let t="INFO";-1==o[s].log_level?t="WARN":-2==o[s].log_level?t="ERROR":-3==o[s].log_level?t="FATAL":1==o[s].log_level&&(t="DEBUG"),i+="<p>"+o[s].create_time+"&#X3000;"+o[s].seq+"&#X3000;"+t+"&#X3000;"+o[s].log+"</p>"}l.content=i,console.log("intervalID:"+l.intervalID),i||(l.content=this.$t("taskLog.zanwu-rizhi"));let a=document.getElementById("task_info");if(a.scrollTop=a.scrollHeight,0!==t.state)return clearInterval(l.timeoutId),void(l.reading=!1);0!==o.length&&(console.log(o[o.length-1].seq),o[o.length-1].seq),l.reading=!1},closeDialog:function(){this.showTaskDetailVisible=!1,clearInterval(this.timeoutId),this.closeCallBack&&(console.log("call closeCallBack"),this.closeCallBack())},handleClose:function(t){if(this.closing=!0,this.reading){console.log("==== wait closing for API.getGeneralTaskLog call return...");let e=this;setTimeout((function(){e.handleClose(t)}),100)}else this.timeoutId&&(console.log("In close Dialog clearTimeout"+this.timeoutId),clearTimeout(this.timeoutId),this.timeoutId=""),this.closing=!1,t(),this.$emit("close-refresh"),this.closeCallBack&&(console.log("call closeCallBack"),this.closeCallBack())}},destroyed(){clearInterval(this.intervalID)}},(function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"text-align":"left"},attrs:{title:t.$t("taskLog.rizhi-xinxi"),"modal-append-to-body":!1,"append-to-body":!0,visible:t.showTaskDetailVisible,"close-on-click-modal":!1,"element-loading-text":t.$t("taskLog.nuli-zhuangzaizhong"),width:"70%","before-close":t.handleClose,"lock-scroll":""},on:{"update:visible":function(e){t.showTaskDetailVisible=e}}},[l("div",[l("div",{directives:[{name:"loading",rawName:"v-loading",value:t.closing,expression:"closing"}],attrs:{"element-loading-text":t.$t("taskLog.zhengzai-guanbi-message")}},[l("el-card",{staticClass:"box-card",staticStyle:{"overflow-y":"auto"},style:{height:t.curHeight+"px"},attrs:{shadow:"never",id:"task_info"}},[l("div",{domProps:{innerHTML:t._s(t.content)}})])],1)])])],1)}),[],!1,s,"5ad88d22",null,null);function s(t){for(let e in o)this[e]=o[e]}var n=function(){return a.exports}();export{n as default};
